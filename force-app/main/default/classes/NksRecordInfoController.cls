public class NksRecordInfoController {
    private static LoggerUtility logger = new LoggerUtility('NksRecordInfoController');
    /**
     * @description
     * @author Stian Ruud Schikora | 09-14-2020
     * @param parentId [Id of the object to query to relation from]
     * @param relationshipField [API name of lookup field]
     * @param objectApiName [API name of parent]
     * @return sObject
     **/
    @AuraEnabled
    public static sObject getRelatedRecord(String parentId, String relationshipField, String objectApiName) {
        return getReverseRelatedRecord(parentId, relationshipField, objectApiName, 'Id', null)[0];
    }

    @AuraEnabled(cacheable=true)
    public static List<SObject> getReverseRelatedRecord(
        String parentId,
        string queryFields,
        string objectApiName,
        string relationshipField
    ) {
        return getReverseRelatedRecord(parentId, queryFields, objectApiName, relationshipField, null);
    }

    @AuraEnabled(cacheable=true)
    public static List<SObject> getReverseRelatedRecord(
        String parentId,
        string queryFields,
        string objectApiName,
        string relationshipField,
        string ordering
    ) {

        if (queryFields == null) {
            queryFields = 'Id';
        }
        
        String query =
            'SELECT ' +
            queryFields +
            ' FROM ' +
            objectApiName +
            ' WHERE ' +
            relationshipField +
            '=\'' +
            parentId +
            '\'';
        if (ordering != null) {
            query += ' ORDER BY ' + ordering;
        } else {
            query += ' ORDER BY Id';
        }
        
        try {
            return Database.query(query);
        } catch (Exception e) {
            logger.error(
                'NksRecordInfoController query failed. Query: ' + query + 
                ' | parentId: ' + parentId + 
                ' | queryFields: ' + queryFields + 
                ' | objectApiName: ' + objectApiName + 
                ' | relationshipField: ' + relationshipField + 
                ' | ordering: ' + ordering + 
                ' | Exception: ' + e.getMessage(),
                null,
                CRM_ApplicationDomain.Domain.NKS
            );
            logger.publish();
            throw e;
        }
    }
}
