<template>
    <template lwc:if={personIdentNotNull}> 
        <p class="header-info">Salesforce har en feil som gjør at brukerinformasjonen i toppen noen ganger forsvinner på chat. Derfor ligger den her også for å sikre at informasjonen alltid er tilgjengelig.</p>
            <div class="header-class">
                <lightning-layout-item
                    class="custom-padding-around-small custom-grid-vertical-align-center unselectable"
                    aria-hidden="true"
                >
                    <c-nks-custom-svg size="large" src={genderIconSrc} alt-text={genderText}></c-nks-custom-svg>
                </lightning-layout-item>
                <h1><template if:true={fullName}> {fullName} </template></h1>
                <p class="sr-only unselectable">{genderText}</p>
            </div>

            <div class="content-container">
                <div class="person-info-grid">
                    <div class="info-section">
                        <div class="info-content">
                            <template if:true={personIdent}>
                                <span class="info-text">{personIdent}</span>
                                <lightning-button-icon
                                    value={personIdent}
                                    class="copy-button"
                                    icon-name="utility:copy"
                                    variant="bare"
                                    onclick={handleCopy}
                                    alternative-text="Kopier fødselsnummer"
                                    title="Kopier fødselsnummer"
                                ></lightning-button-icon>
                            </template>
                        </div>
                    </div>

                    <div class="info-section">
                        <div class="info-content">
                            <span class="info-text">{formattedPersonInfo}</span>
                        </div>
                    </div>

                    <template lwc:if={formattedWrittenStandard}>
                        <div class="info-section">
                            <div class="info-content">
                                <span class="info-text">{formattedWrittenStandard}</span>
                            </div>
                        </div>
                    </template>

                    <template lwc:if={formattedUnit}>
                        <div class="info-section">
                            <div class="info-content">
                                <span class="info-text">{formattedUnit}</span>
                                <lightning-button-icon
                                    value={formattedUnitLink}
                                    icon-name="utility:copy"
                                    variant="bare"
                                    onclick={handleCopy}
                                    alternative-text="Kopier Nav enhet"
                                    title="Kopier Nav enhet"
                                    class="copy-button"
                                ></lightning-button-icon>
                            </div>
                        </div>
                    </template>

                    <template lwc:if={formattedVeileder}>
                        <div class="info-section">
                            <div class="info-content">
                                <span class="info-text">{formattedVeileder}</span>
                                <lightning-button-icon
                                    value={veilederName}
                                    class="copy-button"
                                    icon-name="utility:copy"
                                    variant="bare"
                                    onclick={handleCopy}
                                    alternative-text="Kopier veileders navn"
                                    title="Kopier veileders navn"
                                ></lightning-button-icon>
                            </div>
                        </div>
                    </template>
                </div>

                <div class="badges-container">
                    <span lwc:if={uuAlertText} class="slds-assistive-text" role="alert">{uuAlertText}</span>
                    
                    <template for:each={personAccessBadges} for:item="badge">
                        <div key={badge.name} class="badge-wrapper">
                            <lightning-badge
                                class="slds-theme_error slds-var-m-vertical_xx-small slds-badge"
                                data-id={badge.name}
                                label={badge.label}
                                role="heading"
                            >
                            </lightning-badge>
                        </div>
                    </template>

                    <template for:each={badges} for:item="badge">
                        <div key={badge.name} data-id={badge.name} class="badge-wrapper relativePosition">
                            <template lwc:if={badge.clickable}>
                                <lightning-badge
                                    data-id={badge.name}
                                    label={badge.label}
                                    icon-name={badge.iconName}
                                    icon-position="start"
                                    class={badge.styling}
                                    tabindex={badge.tabindex}
                                    onkeypress={onKeyPressHandler}
                                    onclick={onClickHandler}
                                    aria-expanded="false"
                                    role="heading"
                                >
                                </lightning-badge>
                            </template>
                            <template lwc:else>
                                <lightning-badge
                                    data-id={badge.name}
                                    label={badge.label}
                                    icon-name={badge.iconName}
                                    icon-position="start"
                                    class={badge.styling}
                                    role="heading"
                                >
                                </lightning-badge>
                            </template>
                            <template lwc:if={badge.badgeContent}>
                                <c-nks-person-highlight-panel-badge-content
                                    data-id={badge.badgeContentType}
                                    shown-badge={shownBadge}
                                    type={badge.badgeContentType}
                                    badge-data={badge.badgeContent}
                                    onbadgeclosed={closeBadge}
                                    badge-styling={badge.styling}
                                ></c-nks-person-highlight-panel-badge-content>
                            </template>
                        </div>
                    </template>

                    <template lwc:if={isArbeidssoeker}>
                        <div class="badge-wrapper">
                            <lightning-badge
                                class="slds-theme_warning slds-var-m-vertical_xx-small slds-badge"
                                label="Arbeidssøker"
                                role="heading"
                            >
                            </lightning-badge>
                        </div>
                    </template>
                </div>

                <div class="links-container">
                    <template for:each={links} for:item="link">
                        <lightning-layout-item key={link.id}>
                            <a onclick={link.onclick}>{link.name}</a>
                        </lightning-layout-item>
                    </template>
                </div>

                <div class="fagsystemer-wrapper">
                    <c-nks-fagsystemer
                        record-id={personId}
                        related-field="Id"
                        object-api-name="Person__c"
                        person-id="true"
                        title="Lenker"
                        hide-refresh-button
                    ></c-nks-fagsystemer>
                </div>
            </div>
    </template>
</template>
